"use strict";var _createClass=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(function(){var m,e;m=jQuery,e=function(){function i(e){var t;_classCallCheck(this,i),this.initializeFilter=this.initializeFilter.bind(this),this.initializeRatingFilter=this.initializeRatingFilter.bind(this),this.filterContributions=this.filterContributions.bind(this),this.initializeTabs=this.initializeTabs.bind(this),this.activateTab=this.activateTab.bind(this),this.initializeAttachmentFields=this.initializeAttachmentFields.bind(this),this.initializeFieldToggler=this.initializeFieldToggler.bind(this),this.initializeValidation=this.initializeValidation.bind(this),this.initializeVoting=this.initializeVoting.bind(this),this.initializeNotifications=this.initializeNotifications.bind(this),this.initializeModal=this.initializeModal.bind(this),this.initializeFlagging=this.initializeFlagging.bind(this),this.handleModalAjaxResponse=this.handleModalAjaxResponse.bind(this),this.showModal=this.showModal.bind(this),this.hideModal=this.hideModal.bind(this),this.refreshNonce=this.refreshNonce.bind(this),this.initializeReviewEditing=this.initializeReviewEditing.bind(this),this.initializeReviewUpdating=this.initializeReviewUpdating.bind(this),this.checkReviewUpdated=this.checkReviewUpdated.bind(this),this.options=e,t=window.location.hash&&0===window.location.hash.indexOf("share")?window.location.hash.split("-")[1]:null,this.options.comment_type=this.options.comment_type||t,this.initializeModal(),this.initializeTabs(),this.initializeRadioButtons(),this.initializeAttachmentFields(),this.initializeRatingFields(),this.initializeFieldToggler(),this.initializeValidation(),this.initializeVoting(),this.initializeNotifications(),this.initializeFlagging(),this.initializeTips(),this.initializeFilter(),this.initializeRatingFilter(),this.initializeReviewEditing(),this.initializeDefaultReviewEditing(),this.initializeReviewUpdating(),this.checkReviewUpdated(),this.removeReviewAttachment(),this.emptyReviewAttchmentURL(),this.checkGuestSaveReview(),this.initializeGuestWatch(),this.submitGuestWatch()}return _createClass(i,[{key:"initializeFilter",value:function(){var i=this;return m(".contributions-filter select").on("change",function(e){var t;return t=m(e.currentTarget),i.filterContributions(t.val())}),m(".js-clear-filters").on("click",function(e){return e.preventDefault(),m(".contributions-filter select").val("").trigger("change")})}},{key:"initializeRatingFilter",value:function(){var i=this;return m("#reviews .product-rating-details a").on("click",function(e){var t;return e.preventDefault(),t=m(e.currentTarget),m(".contributions-filter select").val("comment_type=review"),i.filterContributions(decodeURIComponent(t.attr("href")).split("comments_filter=")[1].split("#")[0])})}},{key:"filterContributions",value:function(e){var t=this;return m("#contributions-list-title").text(this.options.i18n.loading),m("#contributions-list .contributions-container").empty().addClass("loading"),m.get(this.options.ajax_url,{action:"wc_product_reviews_pro_contributions_list",product_id:this.options.product_id,comments_filter:e},function(e){return m("#contributions-list").html(e),t.hideFlagForms(),t.initializeFieldToggler(),t.initializeTips()}),e?m(".js-clear-filters").show():m(".js-clear-filters").hide()}},{key:"initializeRadioButtons",value:function(){return m("#reviews").on("click",".form-contribution input[type='radio']",function(e){var t,i,n;if(n=e.currentTarget,!(t=(i=m(n)).closest(".form-row")).hasClass("validate-required"))return n.value===t.attr("data-prev-value")?(i.prop("checked",!1).trigger("change"),t.attr("data-prev-value","")):t.attr("data-prev-value",n.value)})}},{key:"initializeTabs",value:function(){var i=this;return this.$contributionTabs=m(".contribution-form-wrapper"),this.options.comment_type&&"contribution_comment"!==this.options.comment_type&&this.activateTab(this.options.comment_type),m(".js-switch-contribution-type").on("click",function(e){var t;return e.preventDefault(),t=m(e.currentTarget),i.activateTab(t.attr("href").split("-")[1])})}},{key:"activateTab",value:function(e){return this.$contributionTabs.removeClass("active"),this.$contributionTabs.filter("#"+e+"_form_wrapper").addClass("active"),m('.js-switch-contribution-type[href="#share-'+e+'"]').addClass("active").siblings(".active").removeClass("active")}},{key:"initializeRatingFields",value:function(){return m("#review_rating_field").each(function(e,t){var i,n;return i=m(t),n=m('<span class="star-label" data-selected-text="" />'),i.append(n),i.find("label.checkbox").each(function(e,t){var i;return(i=m(t)).hover(n.text(i.text()))}),i.find("input").on("change",function(){var e;return e=i.siblings('label.checkbox[for="review_rating_'+i.val()+'"]').text(),n.text(e).data("selected-text",e)})})}},{key:"initializeAttachmentFields",value:function(){var l=this;return m(".form-contribution .attachment-url").each(function(e,t){var i,n;if((n=(i=m(t)).closest("form").find(".attachment-file")).length)return i.add(n).prepend('<a href="#" class="toggle-attachment-source"></a>')}),m(".form-contribution .attachment-type").each(function(e,t){var i,n,r,a,o,s,c;return s=(a=(n=m(t)).closest("form")).find('input[name="comment_type"]').val(),i=n.find("input"),o=a.find(".attachment-url"),r=a.find(".attachment-file"),-1===m.inArray(s,["video","photo"])&&o.hide(),r.hide(),c=function(e){return o.find(".toggle-attachment-source").text(l.options.i18n["attach_"+e+"_file"]),r.find(".toggle-attachment-source").text(l.options.i18n["attach_"+e+"_url"])},i.val()&&c(i.val()),i.on("change",function(e){var t,i,n;return i=e.currentTarget,t=m(i),n=i.value,t.is(":checked")&&n?(c(n),"video"===n?(r.hide(),o.find(".toggle-attachment-source").hide()):o.find(".toggle-attachment-source").show(),o.is(":visible")||r.is(":visible")?void 0:o.slideDown("fast")):(o.slideUp("fast"),r.slideUp("fast"))}).each(function(e,t){var i;return n=m(t),i=t.value,n.next("label.checkbox").attr("title",l.options.i18n["attach_a_"+i]).addClass("js-tip")}),n.find("label:first-child").hide(),a.find(".toggle-attachment-source").on("click",function(e){return e.preventDefault(),r.slideToggle("fast"),o.slideToggle("fast")}),r.on("change","input",function(e){var t,i;if(i=e.currentTarget,(t=m(i)).siblings(".wc-product-reviews-pro-validation-error").remove(),!i.files[0].type.match("image.*"))return t.after('<span class="wc-product-reviews-pro-validation-error">'+l.options.i18n.file_not_allowed+"</span>")})})}},{key:"initializeFieldToggler",value:function(){var r=this;return m(".form-contribution:not(.field-toggler-initialized)").each(function(e,t){var i,n;if(n=(i=m(t)).find('input[name="comment_type"]').val(),m(".star-rating-selector:not(.validate-required )").insertAfter("#review_comment_field"),r.options.comment_type!==n)return i.find(".form-row:not(:first)").hide(),i.find(".wc-product-reviews-pro-form-submit-row").hide(),i.find(".form-row:first").find("input, textarea, select").one("focus change",function(e){var t,i;return"photo"!==(i=(t=m(e.currentTarget).closest("form")).find('input[name="comment_type"]').val())&&"video"!==i?(t.find(".form-row:hidden:not(:contains(.input-hidden)):not(.attachment-source)").slideDown("fast"),t.find(".wc-product-reviews-pro-form-submit-row:hidden:not(:contains(.input-hidden)):not(.attachment-source)").slideDown("fast")):"photo"===i?(t.find(".form-row:hidden:not(:contains(.input-hidden)):not(.attachment-file)").slideDown("fast"),t.find(".wc-product-reviews-pro-form-submit-row:hidden:not(:contains(.input-hidden)):not(.attachment-file)").slideDown("fast")):(t.find(".form-row:hidden:not(:contains(.input-hidden))").slideDown("fast"),t.find(".wc-product-reviews-pro-form-submit-row:hidden:not(:contains(.input-hidden))").slideDown("fast"))}),i.addClass("field-toggler-initialized")})}},{key:"initializeValidation",value:function(){var f=this;return m("#reviews").on("submit",".form-contribution",function(e){var t,d,i,p,n,h,r;if(e.preventDefault(),t=m(e.currentTarget),h=t.find('input[name="comment_type"]').val(),t.find(".wc-product-reviews-pro-validation-error").remove(),p=f.options.file_size_max,d=0,t.find("input,select,textarea").each(function(e,t){var i,n,r,a,o,s,c,l,u;switch(s=(i=m(t)).attr("name"),u=i.val(),i.closest(".form-row").hasClass("validate-required")&&"review_rating"!==s&&!u&&(i.after('<span class="wc-product-reviews-pro-validation-error">'+f.options.i18n.error_required+"</span>"),d++),s){case h+"_comment":if(l=(r=i).data("min-word-count"),c=r.data("max-word-count"),l||c){if(a=m.trim(r.val()).split(" ").length,l&&a<l)return r.after('<span class="wc-product-reviews-pro-validation-error">'+f.options.i18n.error_too_short.replace(/%d/g,l)+"</span>"),d++;if(c&&c<a)return r.after('<span class="wc-product-reviews-pro-validation-error">'+f.options.i18n.error_too_long.replace(/%d/g,c)+"</span>"),d++}break;case h+"_attachment_file":if(n=i,o=null,"undefined"!=typeof FileReader&&null!==FileReader&&0<t.files.length&&(o=t.files[0].size),null!=o&&p<o)return n.after('<span class="wc-product-reviews-pro-validation-error">'+f.options.i18n.error_file_size_max+"</span>"),d++}}),"photo"===h&&(r=t.find(".attachment-url input").val(),i=t.find(".attachment-file input").val(),r||i||(t.find(".attachment-url input").after('<span class="wc-product-reviews-pro-validation-error">'+f.options.i18n.error_attach_file+"</span>"),t.find(".attachment-file input").after('<span class="wc-product-reviews-pro-validation-error">'+f.options.i18n.error_attach_file+"</span>"))),!d)return n=function(){return t.get(0).submit()},!f.options.is_user_logged_in&&f.options.comment_registration?(m(".guest-switcher").data("target","form-contribution"),m("#guest_login, .guest-switcher, .switcher .login").hide(),m("#customer_login, .switcher .register").show(),f.showModal().one("login",function(){return n()})):n()})}},{key:"initializeVoting",value:function(){var l=this;return m("#comments").on("click",".contribution-actions .vote",function(e){var i,n,r,a,t,o,s,c;return e.preventDefault(),a=m(e.currentTarget),s=a.hasClass("vote-down")?"negative":"positive",o=a.data("comment-id"),i=a.siblings(".feedback").html(""),r=a.siblings(".vote-count-positive"),n=a.siblings(".vote-count-negative"),c=a.hasClass("done"),t=function(){return m.ajax({type:"POST",url:l.options.ajax_url,data:{action:"wc_product_reviews_pro_vote",security:l.options.nonce,vote:s,comment_id:o},success:function(e){var t;return i.css("display","inline-block"),setTimeout(function(){return i.fadeOut()},2e3),e.data&&e.data.message?(i.text(e.data.message),e.success?(i.removeClass("error"),r.text("("+e.data.positive_votes+")"),n.text("("+e.data.negative_votes+")"),a.removeClass("done").siblings(".vote").removeClass("done"),c||a.addClass("done"),t=e.data.positive_votes||e.data.negative_votes?l.options.i18n.comment_karma.replace("%1$d",e.data.positive_votes).replace("%2$d",e.data.total_votes):"",a.closest(".comment_container").find(".contribution-karma").text(t)):i.addClass("error")):i.text(l.options.i18n.vote_failed).addClass("error")}})},l.options.is_user_logged_in?t():(m(".guest-switcher").data("target","vote"),m("#guest_login, .guest-switcher, .switcher .login").hide(),m("#customer_login, .switcher .register").show(),l.showModal().one("login",function(){return t()}))})}},{key:"initializeNotifications",value:function(){var o=this;return m("#comments").on("click",".contribution-actions .notifications",function(e){var t,i,n,r,a;return e.preventDefault(),i=m(e.currentTarget),a=i.hasClass("subscribe")?"subscribe":"unsubscribe",n=i.data("comment-id"),t=i.siblings(".feedback").html(""),r=function(){return m.ajax({type:"POST",url:o.options.ajax_url,data:{action:"wc_product_reviews_pro_notify_replies",security:o.options.nonce,manage:a,user_id:o.options.user_id,comment_id:n},success:function(e){return t.css("display","inline-block"),setTimeout(function(){return t.fadeOut()},2e3),e.data&&e.data.message?(t.text(e.data.message),e.success?(i.hide(),"subscribe"===a?i.parent().find(".unsubscribe").show():i.parent().find(".subscribe").show(),t.removeClass("error")):t.addClass("error")):t.text(o.options.i18n.subscribe_failed).addClass("error")}})},o.options.is_user_logged_in?r():(m(".guest-switcher").data("target","notification"),m("#guest_login, .switcher .login").hide(),m("#customer_login, .guest-switcher, .switcher .register").show(),m("#guest-comment-id").val(n),o.showModal().one("login",function(){return r()}))})}},{key:"initializeModal",value:function(){var t,n=this;return this.$modal=t=m("#wc-product-reviews-pro-modal"),this.$overlay=m("#wc-product-reviews-pro-modal-overlay"),this.$modalContainer=m("#wc-product-reviews-pro-modal-container"),t.find("a.close").on("click",function(e){return e.preventDefault(),n.hideModal()}),t.find(".switcher a").on("click",function(e){return e.preventDefault(),m(e.currentTarget).closest(".switcher").find("p").toggle(),t.find(".col-1, .col-2").toggle().filter(":visible").find(".woocommerce-Input").first().focus()}),t.find("form.login").on("submit",function(e){var t,i;return e.preventDefault(),i=(t=m(e.currentTarget)).find("#woocommerce-login-nonce").val(),m.post(n.options.ajax_url,{username:t.find("#username").val(),password:t.find("#password").val(),_wpnonce:i,login:1,_wc_product_reviews_pro_ajax_login:1},function(e){return n.handleModalAjaxResponse(e,t)})}),t.find("form.register").on("submit",function(e){var t,i;return e.preventDefault(),i=(t=m(e.currentTarget)).find("#woocommerce-register-nonce").val(),m.post(n.options.ajax_url,{email:t.find("#reg_email").val(),username:t.find("#reg_username").val(),password:t.find("#reg_password").val(),register:t.find('[name="register"]').val(),_wpnonce:i,_wc_product_reviews_pro_ajax_register:!0},function(e){return n.handleModalAjaxResponse(e,t)})}),m("#reviews").on("click",".js-wc-product-reviews-pro-show-login-modal",function(e){if(e.preventDefault(),!n.options.is_user_logged_in)return m(".guest-switcher").data("target","js-wc-product-reviews-pro-show-login-modal"),m("#guest_login, .guest-switcher, .switcher .login").hide(),m("#customer_login, .switcher .register").show(),n.showModal().one("login",function(){return window.location.assign(window.location.toString()+"#reviews"),window.location.reload()})})}},{key:"hideFlagForms",value:function(){return m(".contribution-flag-form").hide()}},{key:"initializeFlagging",value:function(){var a=this;return this.hideFlagForms(),m("#comments").on("click",".contribution-actions .js-toggle-flag-form",function(e){var t,i;return e.preventDefault(),t=m(e.currentTarget),m(".flag-response").remove(),i=t.data("comment-id"),m("form#flag-contribution-"+i).slideDown("fast").find("button").removeProp("disabled")}),m("#reviews").on("submit",".contribution-flag-form",function(e){var t,i,n,r;return e.preventDefault(),(i=m(e.currentTarget)).find("button").attr("disabled",!0),t=i.siblings(".contribution-actions").find(".feedback").html(""),n=i.find('input[name="comment_id"]').val(),r=i.find('input[name="flag_reason"]').val(),m.ajax({type:"POST",url:a.options.ajax_url,data:{action:"wc_product_reviews_pro_flag",security:a.options.nonce,comment_id:n,reason:r},success:function(e){return i.slideUp("fast").find("button").removeAttr("disabled"),t.show(),setTimeout(function(){return t.fadeOut()},2e3),e.data&&e.data.message?(t.text(e.data.message),e.success?(t.removeClass("error"),i.prev(".comment_container").find(".js-toggle-flag-form").addClass("done")):t.addClass("error")):t.text(this.options.i18n.flag_failed).addClass("error")}})})}},{key:"initializeTips",value:function(){return m(".js-tip").tipTip({attribute:"title",fadeIn:50,fadeOut:50,delay:200})}},{key:"handleModalAjaxResponse",value:function(e,t){var i,n,r=this;return e.success?this.refreshNonce(function(e){return r.options.is_user_logged_in=!0,t.prevAll(".woocommerce-error").remove(),r.hideModal().trigger("login")}):(t.prevAll(".woocommerce-error").remove(),t.before(null!=(i=null!=e&&null!=(n=e.data)?n.message:void 0)?i:this.options.i18n.error_login_signup))}},{key:"showModal",value:function(){var e,t,i=this;return e=this.$modal,t=this.$overlay,this.$modalContainer,m(document).on("keydown.modal",function(e){if(27===e.keyCode)return i.hideModal()}),t.fadeIn(100).on("click.modal",function(){return i.hideModal()}),m("body").addClass("wc-prp-modal"),e.find(".col-1").show().find(".woocommerce-Input").first().focus(),e.find(".col-2").hide(),e.trigger("showmodal")}},{key:"hideModal",value:function(){return m(document).off("keydown.modal"),m("body").removeClass("wc-prp-modal"),this.$overlay.hide().off("click.modal"),this.$modal.trigger("hidemodal")}},{key:"refreshNonce",value:function(r){var a=this;return m.get(this.options.ajax_url,{action:"wc_product_reviews_pro_refresh_nonce"}).done(function(e){var t,i,n;return a.options.nonce=null!=e&&null!=(t=e.data)?t.nonce:void 0,a.options.user_id=null!=e&&null!=(i=e.data)?i.user_id:void 0,r(null!=e&&null!=(n=e.data)?n.nonce:void 0)})}},{key:"initializeReviewEditing",value:function(){var u=this;return m("#reviews").on("click",".edit-comment",function(e){var s,t,c,l,i;return e.preventDefault(),t=m(e.currentTarget),c=t.siblings(".feedback").html(""),s=t.data("comment-id"),i=m('input[name="comment_post_ID"]').val(),l=m(".form-review"),m.ajax({type:"POST",url:u.options.ajax_url,data:{action:"wc_product_reviews_pro_get_review",security:u.options.nonce,comment_id:s,product_id:i},success:function(e){var t,i,n,r,a,o;return l[0].reset(),l.find(".review_attachment").remove(),e.success?(c.removeClass("error"),m("html, body").animate({scrollTop:m("#review_form_wrapper").offset().top-100},"medium"),o=e.data.review,m("#review_title").val(o.title),m("#review_comment").val(o.content),m("#comment_ID").val(s),l.find(".attachment-file").hide(),l.find(".attachment-url").hide(),""!==o.rating&&m("#review_rating_"+o.rating).prop("checked",!0),""!==o.attachment_type&&(m('input[name="review_attachment_type"]').prop("checked",!1),m("#review_attachment_type_"+o.attachment_type).prop("checked",!0),m("#review_attachment_type_field").data("prev-value",o.attachment_type)),r=":not(.attachment-url)",""!==o.attachment_url&&(m("#review_attachment_url").val(o.attachment_url),r=""),n=":not(.attachment-file)",""!==o.attachment_id&&(n="",a=m("<a>").addClass("remove_attachment").attr("href","#").text(u.options.i18n.remove_attachment),t=m("<img>").attr("src",o.attachment_file_url),(i=m("<div>").addClass("review_attachment").html(a)).append(t),l.find(".attachment-file").append(i)),"yes"===o.subscribed?m("#subscribe_to_replies").prop("checked",!0):m("#subscribe_to_replies").prop("checked",!1),m(".star-rating-selector").removeClass("change-rating"),m("#review_form_wrapper").hasClass("loading")&&m("#review_form_wrapper").removeClass("loading"),l.find(".form-row:hidden:not(:contains(.input-hidden))"+r+n).slideDown("fast"),l.find(".wc-product-reviews-pro-form-submit-row:hidden:not(:contains(.input-hidden))"+r+n).slideDown("fast")):(c.addClass("error"),c.text(e.data.message),setTimeout(function(){return c.fadeOut()},2e3))}})})}},{key:"initializeReviewUpdating",value:function(){var f=this;return m(".form-review").on("click",".update-review",function(e){var t,i,n,r,a,o,s,c,l,u,d,p,h;if(""!==(d=m("#review_comment").val()))return u=m(".form-review .response"),p=m("#review_title").val(),n=m("#comment_ID").val(),s=m('input[name="comment_post_ID"]').val(),c=m('input[name="review_rating"]:checked').val(),i=m("#review_attachment_url").val(),l=m(".form-review .remove_attachment").length,(r=0)<m("#review_attachment_file").length&&0<m("#review_attachment_file")[0].files.length?(a=m("#review_attachment_file")[0].files[0],r=1):a="",t=0<m('input[name="review_attachment_type"]:checked').length?m('input[name="review_attachment_type"]:checked').val():"",h=m("#subscribe_to_replies").is(":checked")?"yes":"no",(o=new FormData).append("action","wc_product_reviews_pro_update_review"),o.append("security",f.options.nonce),o.append("review_title",p),o.append("review_content",d),o.append("comment_id",n),o.append("product_id",s),o.append("rating",c),o.append("attachment_url",i),o.append("attachment_type",t),o.append("delete_attachment",l),o.append("files",a),o.append("file_changed",r),o.append("subscribed",h),m.ajax({type:"POST",url:f.options.ajax_url,data:o,processData:!1,contentType:!1,success:function(e){return u.text(e.data.message),u.css("display","inline-block"),e.success?(u.removeClass("error"),setTimeout(function(){var e;return e=-1!==window.location.href.indexOf("?")?"&":"?",window.location.href=window.location.href+e+"updated="+n},2e3)):u.addClass("error")}});m("#review_comment").after('<span class="wc-product-reviews-pro-validation-error">'+f.options.i18n.error_required+"</span>")})}},{key:"checkReviewUpdated",value:function(){var e,t,i;if(i=window.location.href,(t=new RegExp("[?&]updated(=([^&#]*)|&|#|$)").exec(i))&&t[2])return e=decodeURIComponent(t[2].replace(/\+/g," ")),m(".wc-tabs li").removeClass("active"),m(".wc-tabs li.reviews_tab").addClass("active"),m(".wc-tabs-wrapper .wc-tab").hide(),m("#tab-reviews").show(),m("html, body").animate({scrollTop:m("#comment-"+e).offset().top-100},"medium"),window.history.replaceState(null,null,location.href.replace(/&?[&?]updated=([^&]$|[^&]*)/i,""))}},{key:"removeReviewAttachment",value:function(){return m(".form-review").on("click",".remove_attachment",function(e){return e.preventDefault(),m(".form-review").find(".review_attachment").remove()})}},{key:"emptyReviewAttchmentURL",value:function(){return m("#review_attachment_file").on("change",function(e){return m("#review_attachment_url").val("")})}},{key:"initializeDefaultReviewEditing",value:function(){var i=this;return m(".form-review").on("click",".change-rating",function(e){var t;return e.preventDefault(),m("#review_form_wrapper").addClass("loading"),t=m('input[name="comment_post_ID"]').val(),m.ajax({type:"POST",url:i.options.ajax_url,data:{action:"wc_product_reviews_pro_get_recent_review",security:i.options.nonce,product_id:t},success:function(e){var t;if(e.success)return t=e.data.review,m("#comment-"+t+" .edit-comment").trigger("click")}})})}},{key:"checkGuestSaveReview",value:function(){var p=this;return m(".form-review").on("click","button[type=submit]",function(e){var c,t,l,u,d;if(!p.options.is_user_logged_in)return e.preventDefault(),p.options.comment_registration?(m(".guest-switcher").data("target","form-contribution"),m("#guest_login, .guest-switcher, .switcher .login").hide(),m("#customer_login, .switcher .register").show(),p.showModal().one("login",function(){return m(".form-review").get(0).submit()})):(c=m("#review_email").val(),d=m("#review_comment").val(),t=m("#review_author").val(),l=m('input[name="comment_post_ID"]').val(),u=m(".form-review .response"),""===d||""===c||""===t?void m(".form-review").submit():m.ajax({type:"POST",url:p.options.ajax_url,data:{action:"wc_product_reviews_pro_check_review",security:p.options.nonce,email:c,product_id:l},success:function(e){var t,i,n,r,a,o,s;return e.success?(u.removeClass("error").text("").css("display","none"),0<parseInt(e.data.count)?confirm(p.options.i18n.review_update_confirmation)?(s=m("#review_title").val(),a=m('input[name="review_rating"]:checked').val(),i=m("#review_attachment_url").val(),o=m(".form-review .remove_attachment").length,n=0<m("#review_attachment_file")[0].files.length?m("#review_attachment_file")[0].files[0]:"",t=0<m('input[name="review_attachment_type"]:checked').length?m('input[name="review_attachment_type"]:checked').val():"",(r=new FormData).append("action","wc_product_reviews_pro_review_update_confirmation"),r.append("security",p.options.nonce),r.append("email",c),r.append("review_title",s),r.append("review_content",d),r.append("product_id",l),r.append("rating",a),r.append("attachment_url",i),r.append("attachment_type",t),r.append("delete_attachment",o),r.append("files",n),m.ajax({type:"POST",url:p.options.ajax_url,data:r,processData:!1,contentType:!1,success:function(e){return e.success?u.removeClass("error").text(e.data.message).css("display","inline-block"):u.addClass("error").text(e.data.message).css("display","inline-block"),setTimeout(function(){return u.fadeOut()},2e3)}})):void 0:m(".form-review").submit()):void 0!==e.data.type?alert(e.data.message):(u.addClass("error").text(e.data.message).css("display","inline-block"),setTimeout(function(){return u.fadeOut()},2e3))}}))})}},{key:"initializeGuestWatch",value:function(){return m("#wc-product-reviews-pro-modal").on("click",".guest-link",function(e){return e.preventDefault(),m("#guest_login, #guest_login .col-1, .switcher .login, .switcher .register").show(),m("#customer_login, .guest-switcher").hide()}),m("#wc-product-reviews-pro-modal").on("click",".switcher .register a",function(e){return e.preventDefault(),m("#guest_login, #customer_login .col-1, .switcher .register").hide(),m("#customer_login, #customer_login .col-2, .switcher .login").show(),"notification"===m(".guest-switcher").data("target")?m(".guest-switcher").show():m(".guest-switcher").hide()}),m("#wc-product-reviews-pro-modal").on("click",".switcher .login a",function(e){return e.preventDefault(),m("#guest_login, #customer_login .col-2, .switcher .login").hide(),m("#customer_login, #customer_login .col-1, .guest-switcher, .switcher .register").show(),"notification"===m(".guest-switcher").data("target")?m(".guest-switcher").show():m(".guest-switcher").hide()})}},{key:"submitGuestWatch",value:function(){var a=this;return m(".woocommerce-form-guest").on("click",".guest-watch",function(e){var t,i,n,r;return e.preventDefault(),i=m("#guest_email").val(),r=m('input[name="wc-product-review-pro-guest-nonce"]').val(),t=m("#guest-comment-id").val(),n=m("#comment-"+t).find(".contribution-actions .feedback").html(""),m.ajax({type:"POST",url:a.options.ajax_url,data:{action:"wc_product_reviews_pro_guest_watch",security:r,email:i,comment_id:t},success:function(e){return e.success?(a.hideModal(),n.css("display","inline-block"),setTimeout(function(){return n.fadeOut()},2e3),n.removeClass("error"),n.text(e.data.message)):(n.css("display","none"),n.text(""),m("#guest_login .woocommerce-error").remove(),m('<ul class="woocommerce-error"><li>'+e.data.message+"</li></ul>").insertBefore(".woocommerce-form-guest"))}})})}}]),i}(),m(window).load(function(){return new e(window.wc_product_reviews_pro)})}).call(void 0);